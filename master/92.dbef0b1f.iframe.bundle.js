(self.webpackChunk_jetbrains_ring_ui=self.webpackChunk_jetbrains_ring_ui||[]).push([[92],{"./.storybook/hub-config.ts":function(__unused_webpack_module,__webpack_exports__){"use strict";const{serverUri:serverUri,clientId:clientId}={serverUri:"https://hub.jetbrains.com",clientId:"81a0bffb-6d0f-4a38-b93a-0a4d1e567698"},{origin:origin,pathname:pathname}=window.location,base=pathname.startsWith("/ring-ui/")?"/ring-ui/master/":"/";__webpack_exports__.Z={reloadOnUserChange:!1,embeddedLogin:!0,serverUri:serverUri,clientId:clientId,requestCredentials:"skip",redirectUri:`${origin+base}iframe.html?id=utilities-auth--landing-page`}},"./src/alert-service/alert-service.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_global_react_render_adapter__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/global/react-render-adapter.ts"),_global_get_uid__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/global/get-uid.ts"),_alert_alert__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/alert/container.tsx"),_alert_alert__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/alert/alert.tsx");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const alertService=new class AlertService{defaultTimeout=0;showingAlerts=[];containerElement=document.createElement("div");_getShowingAlerts(){return[...this.showingAlerts]}renderAlertContainer(alerts){return 0===alerts.length?react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null):react__WEBPACK_IMPORTED_MODULE_0__.createElement(_alert_alert__WEBPACK_IMPORTED_MODULE_1__.Z,null,alerts.map((alert=>{const{message:message,key:key,...rest}=alert;return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_alert_alert__WEBPACK_IMPORTED_MODULE_2__.ZP,_extends({key:key},rest),message)})))}renderAlerts(){(0,_global_react_render_adapter__WEBPACK_IMPORTED_MODULE_3__.sY)(this.renderAlertContainer(this.showingAlerts),this.containerElement)}findSameAlert(message,type){return this.showingAlerts.filter((it=>it.type===type&&it.message===message))[0]}startAlertClosing(alert){alert.isClosing=!0,this.renderAlerts()}remove(key){const alertToClose=this.showingAlerts.filter((alert=>alert.key===key))[0];alertToClose&&this.startAlertClosing(alertToClose)}removeWithoutAnimation(key){this.showingAlerts=this.showingAlerts.filter((alert=>alert.key!==key)),this.renderAlerts()}stopShakingWhenAnimationDone(shakingAlert){setTimeout((()=>{shakingAlert.showWithAnimation=!1,shakingAlert.isShaking=!1,this.renderAlerts()}),_alert_alert__WEBPACK_IMPORTED_MODULE_2__.o)}addAlert(message,type){let timeout=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultTimeout,options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{onCloseRequest:onCloseRequest,onClose:onClose,...restOptions}=options,sameAlert=this.findSameAlert(message,type);if(sameAlert)return sameAlert.isShaking=!0,this.renderAlerts(),this.stopShakingWhenAnimationDone(sameAlert),sameAlert.key;const alert={key:(0,_global_get_uid__WEBPACK_IMPORTED_MODULE_4__.Z)("alert-service-"),message:message,type:type,timeout:timeout,isClosing:!1,onCloseRequest:()=>{onCloseRequest&&onCloseRequest(),this.startAlertClosing(alert)},onClose:()=>{onClose&&onClose(),this.removeWithoutAnimation(alert.key)},...restOptions};return this.showingAlerts=[alert,...this.showingAlerts],this.renderAlerts(),alert.key}setDefaultTimeout(timeout){this.defaultTimeout=timeout}error(message,timeout){return this.addAlert(message,_alert_alert__WEBPACK_IMPORTED_MODULE_2__.ZP.Type.ERROR,timeout)}message(message,timeout){return this.addAlert(message,_alert_alert__WEBPACK_IMPORTED_MODULE_2__.ZP.Type.MESSAGE,timeout)}warning(message,timeout){return this.addAlert(message,_alert_alert__WEBPACK_IMPORTED_MODULE_2__.ZP.Type.WARNING,timeout)}successMessage(message,timeout){return this.addAlert(message,_alert_alert__WEBPACK_IMPORTED_MODULE_2__.ZP.Type.SUCCESS,timeout)}loadingMessage(message,timeout){return this.addAlert(message,_alert_alert__WEBPACK_IMPORTED_MODULE_2__.ZP.Type.LOADING,timeout)}};__webpack_exports__.Z=alertService},"./src/auth/auth.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{ZP:function(){return auth}});var response_parser=__webpack_require__("./src/auth/response-parser.ts");var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),alert_service=__webpack_require__("./src/alert-service/alert-service.tsx"),alert_alert=__webpack_require__("./src/alert/alert.tsx"),link_link=__webpack_require__("./src/link/link.tsx"),group=__webpack_require__("./src/group/group.tsx"),down_notification=__webpack_require__("./src/auth/down-notification.css"),down_notification_default=__webpack_require__.n(down_notification);let key=null;function renderAlert(message){let type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:alert_alert.ZP.Type.WARNING;const existingAlert=alert_service.Z.showingAlerts.filter((alert=>alert.key===key))[0];existingAlert?(existingAlert.message=message,existingAlert.type=type,alert_service.Z.renderAlerts()):key=alert_service.Z.addAlert(message,type,0,{closeable:!1})}function Message(_ref){let{translations:translations,onCheckAgain:onCheckAgain}=_ref;const{backendIsNotAvailable:backendIsNotAvailable,checkAgain:checkAgain,errorMessage:errorMessage}=translations;return react.createElement("div",{"data-test":"ring-backend-down-notification"},react.createElement(group.Z,null,react.createElement("div",{className:down_notification_default().title},backendIsNotAvailable)),react.createElement("span",{className:down_notification_default().error},errorMessage," "),react.createElement(link_link.ZP,{onClick:onCheckAgain,"data-test":"check-again"},checkAgain))}Message.propTypes={translations:prop_types_default().shape({backendIsNotAvailable:prop_types_default().string,checkAgain:prop_types_default().string,errorMessage:prop_types_default().string}),onCheckAgain:prop_types_default().func};var auth_core=__webpack_require__("./src/auth/auth__core.ts");auth_core.ZP.DEFAULT_CONFIG={...auth_core.ZP.DEFAULT_CONFIG,EmbeddedLoginFlow:class WindowFlow{_timeoutId=void 0;_requestBuilder;_storage;reject;_loginWindow;_promise;constructor(requestBuilder,storage){this._requestBuilder=requestBuilder,this._storage=storage,this._reset()}_openWindow(url){const top=(window.screen.height-700-50)/2,left=(window.screen.width-750)/2;return window.open(url,"HubLoginWindow",`height=700, width=750, left=${left}, top=${top}`)}async _load(){const authRequest=await this._requestBuilder.prepareAuthRequest({request_credentials:"required",auth_mode:"bypass_to_login"},{nonRedirect:!0});return new Promise(((resolve,reject)=>{let cleanRun;this.reject=reject;const cleanUp=()=>{cleanRun||(cleanRun=!0,removeStateListener(),removeTokenListener(),this._loginWindow?.close(),clearTimeout(this._timeoutId))},removeTokenListener=this._storage.onTokenChange((token=>{token&&(cleanUp(),resolve(token.accessToken))})),removeStateListener=this._storage.onStateChange(authRequest.stateId,(state=>{state&&state.error&&(cleanUp(),reject(new response_parser.Z.AuthError(state)))}));null==this._loginWindow||this._loginWindow.closed?this._loginWindow=this._openWindow(authRequest.url):this._loginWindow.location.href=authRequest.url,this.checkIsClosed()}))}checkIsClosed=()=>{this._loginWindow?.closed?this.stop():this._timeoutId=window.setTimeout(this.checkIsClosed,200)};_reset=()=>{this._promise=null,this._loginWindow=null,clearTimeout(this._timeoutId)};stop(){null!=this._loginWindow&&this._loginWindow.close(),this.reject&&this.reject("Authorization window closed"),this._reset()}authorize(){return null==this._promise||null==this._loginWindow||this._loginWindow.closed?(this._promise=this._load(),this._promise.then(this._reset,this._reset),this._promise):(this._loginWindow.focus(),this._promise)}},onBackendDown:function onBackendDown(_ref2){let{onCheckAgain:onCheckAgain,translations:translations}=_ref2;return renderAlert(react.createElement(Message,{translations:translations,onCheckAgain:async function checkAgainWithoutClosing(e){e.stopPropagation();try{renderAlert("Connecting...",alert_alert.ZP.Type.LOADING),await onCheckAgain()}catch(err){renderAlert(react.createElement(Message,{translations:translations,onCheckAgain:checkAgainWithoutClosing}))}}})),()=>alert_service.Z.remove(key)}};var auth=auth_core.ZP},"./src/auth/auth__core.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{N2:function(){return LOGOUT_POSTPONED_EVENT},sQ:function(){return USER_CHANGED_EVENT},p0:function(){return USER_CHANGE_POSTPONED_EVENT},ZP:function(){return Auth}});var global_url=__webpack_require__("./src/global/url.ts");class Listeners{_all=new Map;trigger(){for(var _len=arguments.length,_ref=new Array(_len),_key=0;_key<_len;_key++)_ref[_key]=arguments[_key];let[event,data]=_ref;const handlers=this._all.get(event);return handlers?Promise.all([...handlers].map((fn=>fn(data)))):Promise.resolve([])}add(event,handler){let handlers=this._all.get(event);handlers||(handlers=new Set,this._all.set(event,handlers)),handlers.add(handler)}remove(event,handler){const handlers=this._all.get(event);handlers&&handlers.delete(handler)}removeAll(){this._all=new Map}}var http=__webpack_require__("./src/http/http.ts");function promiseWithTimeout(promise,timeout,_ref){let{error:error,onTimeout:onTimeout=(()=>{})}=_ref;return new Promise(((resolve,reject)=>{setTimeout((()=>{onTimeout(),reject(error||new Error("Timeout"))}),timeout),promise.then(resolve,reject)}))}var i18n=__webpack_require__("./src/i18n/i18n.ts"),storage=__webpack_require__("./src/storage/storage.ts");class AuthStorage{messagePrefix;stateKeyPrefix;tokenKey;userKey;stateTTL;stateQuota;_lastMessage;_stateStorage;_tokenStorage;_messagesStorage;_currentUserStorage;constructor(config){this.messagePrefix=config.messagePrefix||"",this.stateKeyPrefix=config.stateKeyPrefix||"",this.tokenKey=config.tokenKey||"",this.userKey=config.userKey||"user-key",this.stateTTL=config.stateTTL||864e5,this._lastMessage=null;const StorageConstructor=config.storage||storage.Z;this.stateQuota=Math.min(config.stateQuota||102400,StorageConstructor.QUOTA||1/0),this._stateStorage=new StorageConstructor({cookieName:"ring-state"}),this._tokenStorage=new StorageConstructor({cookieName:"ring-token"}),this._messagesStorage=new StorageConstructor({cookieName:"ring-message"}),this._currentUserStorage=new StorageConstructor({cookieName:"ring-user"})}onTokenChange(fn){return this._tokenStorage.on(this.tokenKey,fn)}onStateChange(stateKey,fn){return this._stateStorage.on(this.stateKeyPrefix+stateKey,fn)}onMessage(key,fn){return this._messagesStorage.on(this.messagePrefix+key,(message=>fn(message)))}sendMessage(key){let message=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._lastMessage=message,this._messagesStorage.set(this.messagePrefix+key,message)}async saveState(id,state,dontCleanAndRetryOnFail){state.created=Date.now();try{await this._stateStorage.set(this.stateKeyPrefix+id,state)}catch(e){if(dontCleanAndRetryOnFail)throw e;return await this.cleanStates(),this.saveState(id,state,!0)}}async cleanStates(removeStateId){const now=Date.now(),currentStates=(await this._stateStorage.each(((key,value)=>{if(null!=value){if(key===this.stateKeyPrefix+removeStateId)return this._stateStorage.remove(key);if(0===key.indexOf(this.stateKeyPrefix)){var _state$created;const state=value,created=null!==(_state$created=state.created)&&void 0!==_state$created?_state$created:Date.now();return created+this.stateTTL<now?this._stateStorage.remove(key):{key:key,created:created,size:JSON.stringify(state).length}}}}))).filter((state=>null!=state));let stateStorageSize=currentStates.reduce(((overallSize,state)=>state.size+overallSize),0);if(stateStorageSize>this.stateQuota){currentStates.sort(((a,b)=>a.created-b.created));const removalPromises=currentStates.filter((state=>stateStorageSize>this.stateQuota&&(stateStorageSize-=state.size,!0))).map((state=>this._stateStorage.remove(state.key)));return removalPromises.length&&Promise.all(removalPromises)}}async getState(id){try{const result=await this._stateStorage.get(this.stateKeyPrefix+id);return await this.cleanStates(id),result}catch(e){throw await this.cleanStates(id),e}}saveToken(token){return this._tokenStorage.set(this.tokenKey,token)}getToken(){return this._tokenStorage.get(this.tokenKey)}wipeToken(){return this._tokenStorage.remove(this.tokenKey)}async getCachedUser(loadUser){const user=await this._currentUserStorage.get(this.userKey),loadAndCache=()=>loadUser().then((response=>(this._currentUserStorage.set(this.userKey,response),response)));return user&&user.id?(setTimeout(loadAndCache,1e3),user):loadAndCache()}wipeCachedCurrentUser(){return this._currentUserStorage.remove(this.userKey)}onUserChanged(){this.wipeCachedCurrentUser()}}var response_parser=__webpack_require__("./src/auth/response-parser.ts"),simply_uuid=__webpack_require__("./node_modules/simply-uuid/index.js"),simply_uuid_default=__webpack_require__.n(simply_uuid);class AuthRequestBuilder{config;storage;constructor(config,storage){this.config=config,this.storage=storage}static _uuid=simply_uuid_default().generate;async prepareAuthRequest(extraParams,extraState){const stateId=AuthRequestBuilder._uuid(),scopes=this.config.scopes.map((scope=>encodeURIComponent(scope))),request=Object.assign({response_type:"token",state:stateId,redirect_uri:this.config.redirectUri,request_credentials:this.config.requestCredentials,client_id:this.config.clientId,scope:scopes.join(" ")},extraParams||{}),authURL=(0,global_url.EQ)(this.config.authorization,request),state=Object.assign({restoreLocation:window.location.href,scopes:this.config.scopes},extraState||{});return await this._saveState(stateId,state),{url:authURL,stateId:stateId}}_saveState(id,storedState){return this.storage?.saveState(id,storedState)}}var background_flow=__webpack_require__("./src/auth/background-flow.ts"),es6=__webpack_require__("./node_modules/es6-error/es6/index.js");class TokenValidationError extends es6.Z{cause;authRedirect;constructor(message,cause){super(message),this.cause=cause,this.authRedirect=!0}}class TokenValidator{_getUser;_config;_storage;constructor(config,getUser,storage){this._getUser=getUser,this._config=config,this._storage=storage}static _epoch(){return Math.round(Date.now()/1e3)}static DEFAULT_REFRESH_BEFORE=600;static TokenValidationError=TokenValidationError;validateTokenLocally(){return this._getValidatedToken([TokenValidator._validateExistence,TokenValidator._validateExpiration,this._validateScopes.bind(this)])}validateToken(){return this._getValidatedToken([TokenValidator._validateExistence,TokenValidator._validateExpiration,this._validateScopes.bind(this),this._validateAgainstUser.bind(this)])}static _validateExistence(storedToken){if(!storedToken||!storedToken.accessToken)throw new TokenValidator.TokenValidationError("Token not found")}static _validateExpiration(_ref){let{expires:expires,lifeTime:lifeTime}=_ref;const refreshBefore=lifeTime?Math.ceil(lifeTime/6):TokenValidator.DEFAULT_REFRESH_BEFORE;if(expires&&expires<TokenValidator._epoch()+refreshBefore)throw new TokenValidator.TokenValidationError("Token expired")}_validateScopes(storedToken){const{scope:scope,optionalScopes:optionalScopes}=this._config;if(!(optionalScopes?scope.filter((scopeId=>!optionalScopes.includes(scopeId))):scope).every((scopeId=>storedToken.scopes?.includes(scopeId))))throw new TokenValidator.TokenValidationError("Token doesn't match required scopes")}static shouldRefreshToken(error){return"invalid_grant"===error||"invalid_request"===error||"invalid_token"===error}async _validateAgainstUser(storedToken){try{return await this._getUser(storedToken.accessToken)}catch(errorResponse){let response={};try{response=await errorResponse.response.json()}catch(e){}if(errorResponse.status===http.cO.UNAUTHORIZED||TokenValidator.shouldRefreshToken(response.error))throw new TokenValidator.TokenValidationError(response.error||errorResponse.message,errorResponse.data?.error?new Error(errorResponse.data?.error):void 0);throw errorResponse}}async _getValidatedToken(validators){const storedToken=await this._storage.getToken();if(null==storedToken)throw new TokenValidator.TokenValidationError("Token not found");for(let i=0;i<validators.length;i++)await validators[i](storedToken);return storedToken.accessToken}}const USER_CHANGED_EVENT="userChange",LOGOUT_POSTPONED_EVENT="logoutPostponed",USER_CHANGE_POSTPONED_EVENT="changePostponed";function noop(){}const DEFAULT_CONFIG={cacheCurrentUser:!1,reloadOnUserChange:!0,embeddedLogin:!1,EmbeddedLoginFlow:null,clientId:"0-0-0-0-0",redirectUri:(0,global_url.YV)(),redirect:!1,requestCredentials:"default",backgroundRefreshTimeout:null,scope:[],userFields:["guest","id","name","login","profile/avatar/url"],cleanHash:!0,onLogout:noop,onPostponeChangedUser:()=>{},onPostponeLogout:()=>{},enableBackendStatusCheck:!0,backendCheckTimeout:1e4,checkBackendIsUp:()=>Promise.resolve(null),onBackendDown:()=>()=>{},defaultExpiresIn:2400,waitForRedirectTimeout:5e3,translations:null};class Auth{static DEFAULT_CONFIG=DEFAULT_CONFIG;static API_PATH="api/rest/";static API_AUTH_PATH="oauth2/auth";static API_PROFILE_PATH="users/me";static CLOSE_BACKEND_DOWN_MESSAGE="backend-check-succeeded";static CLOSE_WINDOW_MESSAGE="close-login-window";static shouldRefreshToken=TokenValidator.shouldRefreshToken;static storageIsUnavailable=!navigator.cookieEnabled;config;listeners=new Listeners;http;_service={};_storage=null;_responseParser=new response_parser.Z;_requestBuilder=null;_backgroundFlow;_embeddedFlow=null;_tokenValidator=null;_postponed=!1;_backendCheckPromise=null;_authDialogService=void 0;_domainStorage;user=null;_initDeferred;_isLoginWindowOpen;constructor(config){if(!config)throw new Error("Config is required");if(null==config.serverUri)throw new Error('"serverUri" property is required');const unsupportedParams=["redirect_uri","request_credentials","client_id"].filter((param=>config.hasOwnProperty(param)));if(0!==unsupportedParams.length)throw new Error(`The following parameters are no longer supported: ${unsupportedParams.join(", ")}. Please change them from snake_case to camelCase.`);config.userFields=config.userFields||[],this.config={...Auth.DEFAULT_CONFIG,...config};const{clientId:clientId,redirect:redirect,redirectUri:redirectUri,requestCredentials:requestCredentials,scope:scope}=this.config,serverUriLength=this.config.serverUri.length;serverUriLength>0&&"/"!==this.config.serverUri.charAt(serverUriLength-1)&&(this.config.serverUri+="/"),this.config.userParams={query:{fields:[...new Set(Auth.DEFAULT_CONFIG.userFields.concat(config.userFields))].join()}},scope.includes(Auth.DEFAULT_CONFIG.clientId)||scope.push(Auth.DEFAULT_CONFIG.clientId),this._storage=new AuthStorage({messagePrefix:`${clientId}-message-`,stateKeyPrefix:`${clientId}-states-`,tokenKey:`${clientId}-token`,userKey:`${clientId}-user-`}),this._domainStorage=new AuthStorage({messagePrefix:"domain-message-"}),this._requestBuilder=new AuthRequestBuilder({authorization:this.config.serverUri+Auth.API_PATH+Auth.API_AUTH_PATH,clientId:clientId,redirect:redirect,redirectUri:redirectUri,requestCredentials:requestCredentials,scopes:scope},this._storage);let{backgroundRefreshTimeout:backgroundRefreshTimeout}=this.config;var _this$config$translat;(backgroundRefreshTimeout||(backgroundRefreshTimeout=this.config.embeddedLogin?1e4:2e4),this._backgroundFlow=new background_flow.Z(this._requestBuilder,this._storage,backgroundRefreshTimeout),this.config.EmbeddedLoginFlow)&&(this._embeddedFlow=new this.config.EmbeddedLoginFlow(this._requestBuilder,this._storage,null!==(_this$config$translat=this.config.translations)&&void 0!==_this$config$translat?_this$config$translat:(0,i18n.l2)()));const API_BASE=this.config.serverUri+Auth.API_PATH,fetchConfig=config.fetchCredentials?{credentials:config.fetchCredentials}:void 0;this.http=new http.ZP(this,API_BASE,fetchConfig);this._tokenValidator=new TokenValidator(this.config,(async token=>{const user=await this.getUser(token);return this.user=user,user}),this._storage),this.config.onLogout&&this.addListener("logout",this.config.onLogout),this.config.reloadOnUserChange&&this.addListener(USER_CHANGED_EVENT,(()=>this._reloadCurrentPage())),this.addListener(LOGOUT_POSTPONED_EVENT,(()=>this._setPostponed(!0))),this.addListener(USER_CHANGE_POSTPONED_EVENT,(()=>this._setPostponed(!0))),this.addListener(USER_CHANGED_EVENT,(()=>this._setPostponed(!1))),this.addListener(USER_CHANGED_EVENT,(user=>{user&&this._updateDomainUser(user.id)})),this.config.cacheCurrentUser&&(this.addListener("logout",(()=>this._storage?.wipeCachedCurrentUser())),this.addListener(USER_CHANGED_EVENT,(()=>this._storage?.onUserChanged()))),this._createInitDeferred(),this.setUpPreconnect(config.serverUri)}_setPostponed(){let postponed=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._postponed=postponed}_updateDomainUser(userID){this._domainStorage.sendMessage("domainUser",{userID:userID,serviceID:this.config.clientId})}addListener(event,handler){this.listeners.add(event,handler)}removeListener(event,handler){this.listeners.remove(event,handler)}setAuthDialogService(authDialogService){this._authDialogService=authDialogService}setCurrentService(service){this._service=service}_createInitDeferred(){const deferred={};deferred.promise=new Promise(((resolve,reject)=>{deferred.resolve=resolve,deferred.reject=reject})),this._initDeferred=deferred}async init(){let state;this._storage?.onTokenChange((async token=>{if(!(!!this.user&&this.user.guest)||token)if(token)try{await this._detectUserChange(token.accessToken)}catch(error){if(!(error instanceof Error))throw error;this._canShowDialogs()&&this._showAuthDialog({nonInteractive:!0,error:error})}else this.logout()})),this._domainStorage.onMessage("domainUser",(message=>{const{userID:userID,serviceID:serviceID}=message||{};serviceID!==this.config.clientId&&(this.user&&userID===this.user.id||this.forceTokenUpdate())}));try{state=await this._checkForAuthResponse()}catch(error){return error instanceof Error?this.handleInitError(error):void 0}if(state&&state.nonRedirect)return new Promise(noop);try{await(this._tokenValidator?.validateToken());const message=await this._domainStorage._messagesStorage.get("domain-message-domainUser");if(message){const{userID:userID,serviceID:serviceID}=message;serviceID===this.config.clientId||userID&&this.user?.id===userID||this.forceTokenUpdate()}return state||(state=await this._checkForStateRestoration()),this._initDeferred?.resolve?.(state&&state.restoreLocation),state?.restoreLocation}catch(error){return Auth.storageIsUnavailable?(this._initDeferred?.resolve?.(),await this.requestUser(),null):error instanceof Error?this.handleInitValidationError(error):void 0}}async sendRedirect(error){const authRequest=await(this._requestBuilder?.prepareAuthRequest());throw null!=authRequest&&this._redirectCurrentPage(authRequest.url),await new Promise((resolve=>setTimeout(resolve,this.config.waitForRedirectTimeout))),error}async handleInitError(error){if("stateId"in error&&error.stateId)try{const state=await(this._storage?.getState(error.stateId));if(state&&state.nonRedirect)return state.error=error,this._storage?.saveState(error.stateId,state),new Promise(noop)}catch(e){}throw error}async handleInitValidationError(error){if("cause"in error&&error.cause instanceof Error&&"invalid_client"===error.cause?.message)return console.error("RingUI Auth: invalid client detected. Logging out",error),void await this.logout();if("authRedirect"in error&&error.authRedirect&&this.config.redirect)return this.sendRedirect(error);if("authRedirect"in error&&error.authRedirect&&!this.config.redirect)try{return await(this._backgroundFlow?.authorize()),await(this._tokenValidator?.validateToken()),void this._initDeferred?.resolve?.()}catch(validationError){return validationError instanceof Error?this.sendRedirect(validationError):void 0}throw this._initDeferred?.reject?.(error),error}async requestToken(){if(this._postponed)throw new Error("You should log in to be able to make requests");try{var _await$this$_tokenVal;return await(this._initDeferred?.promise),Auth.storageIsUnavailable?null:null!==(_await$this$_tokenVal=await(this._tokenValidator?.validateTokenLocally()))&&void 0!==_await$this$_tokenVal?_await$this$_tokenVal:null}catch(e){return this.forceTokenUpdate()}}async forceTokenUpdate(){try{this._backendCheckPromise||(this._backendCheckPromise=this._checkBackendsStatusesIfEnabled()),await this._backendCheckPromise}catch(e){throw new Error("Cannot refresh token: backend is not available. Postponed by user.")}finally{this._backendCheckPromise=null}try{var _await$this$_backgrou;return null!==(_await$this$_backgrou=await(this._backgroundFlow?.authorize()))&&void 0!==_await$this$_backgrou?_await$this$_backgrou:null}catch(error){if(!(error instanceof Error))return null;if(this._canShowDialogs())return new Promise((resolve=>{const onTryAgain=async()=>{try{const result=await(this._backgroundFlow?.authorize());resolve(null!=result?result:null)}catch(retryError){throw retryError instanceof Error&&this._showAuthDialog({nonInteractive:!0,error:retryError,onTryAgain:onTryAgain}),retryError}};this._showAuthDialog({nonInteractive:!0,error:error,onTryAgain:onTryAgain})}));{const authRequest=await(this._requestBuilder?.prepareAuthRequest());null!=authRequest&&this._redirectCurrentPage(authRequest.url)}throw new TokenValidator.TokenValidationError(error.message)}}async loadCurrentService(){if(!this._service.serviceName)try{const{serviceName:serviceName,iconUrl:serviceImage}=await this.http.get(`oauth2/interactive/login/settings?client_id=${this.config.clientId}`)||{};this.setCurrentService({serviceImage:serviceImage,serviceName:serviceName})}catch(e){}}getAPIPath(){return this.config.serverUri+Auth.API_PATH}getUser(accessToken){return this.config.cacheCurrentUser?this._storage?.getCachedUser((()=>this.http.authorizedFetch(Auth.API_PROFILE_PATH,accessToken,this.config.userParams))):this.http.authorizedFetch(Auth.API_PROFILE_PATH,accessToken,this.config.userParams)}async requestUser(){if(this.user)return this.user;const accessToken=await this.requestToken();if(this.user)return this.user;const user=await this.getUser(accessToken);return this.user=user,user}async updateUser(){this._setPostponed(!1);const accessToken=await this.requestToken();this._storage?.wipeCachedCurrentUser();const user=await this.getUser(accessToken);this.user=user,this.listeners.trigger(USER_CHANGED_EVENT,user)}async _detectUserChange(accessToken){const windowWasOpen=this._isLoginWindowOpen,user=await this.getUser(accessToken),onApply=()=>{this.user=user,this.listeners.trigger(USER_CHANGED_EVENT,user)};if(user&&this.user&&this.user.id!==user.id){if(!this._canShowDialogs()||this.user.guest||windowWasOpen)return void onApply();if(user.guest)return void this._showAuthDialog({nonInteractive:!0});await this._showUserChangedDialog({newUser:user,onApply:onApply,onPostpone:()=>{this.listeners.trigger(USER_CHANGE_POSTPONED_EVENT),this.config.onPostponeChangedUser(this.user,user)}})}}_beforeLogout(params){this._canShowDialogs()?this._showAuthDialog(params):this.logout()}_showAuthDialog(){let{nonInteractive:nonInteractive,error:error,canCancel:canCancel,onTryAgain:onTryAgain}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{embeddedLogin:embeddedLogin,onPostponeLogout:onPostponeLogout,translations:translations}=this.config,cancelable=this.user?.guest||canCancel,actualTranslations=null!=translations?translations:(0,i18n.FC)();this._createInitDeferred();const closeDialog=()=>{stopTokenListening?.(),stopMessageListening?.(),hide?.()},hide=this._authDialogService?.({...this._service,loginCaption:actualTranslations.login,loginToCaption:actualTranslations.loginTo,confirmLabel:actualTranslations.login,tryAgainLabel:actualTranslations.tryAgainLabel,cancelLabel:cancelable?actualTranslations.cancel:actualTranslations.postpone,errorMessage:this._extractErrorMessage(error,!0),onConfirm:()=>{if(!embeddedLogin)return closeDialog(),void this.logout();this._runEmbeddedLogin()},onCancel:()=>{if(this._embeddedFlow?.stop(),this._storage?.sendMessage(Auth.CLOSE_WINDOW_MESSAGE,Date.now()),closeDialog(),!cancelable)return this._initDeferred?.resolve?.(),this.listeners.trigger(LOGOUT_POSTPONED_EVENT),void onPostponeLogout();this.user?.guest&&nonInteractive?this.forceTokenUpdate():this._initDeferred?.resolve?.()},onTryAgain:onTryAgain?async()=>{await(onTryAgain?.()),closeDialog()}:void 0}),stopTokenListening=this._storage?.onTokenChange((token=>{token&&(closeDialog(),this._initDeferred?.resolve?.())})),stopMessageListening=this._storage?.onMessage(Auth.CLOSE_WINDOW_MESSAGE,(()=>this._embeddedFlow?.stop()))}_showUserChangedDialog(_ref){var _translations$youHave,_newUser$name,_newUser$name2,_translations$login,_translations$loginTo,_translations$applyCh,_translations$tryAgai,_translations$postpon;let{newUser:newUser,onApply:onApply,onPostpone:onPostpone}=_ref;const{translations:translations}=this.config;this._createInitDeferred();const done=()=>{this._initDeferred?.resolve?.(),hide?.()},hide=this._authDialogService?.({...this._service,title:null!==(_translations$youHave=translations?.youHaveLoggedInAs)&&void 0!==_translations$youHave?_translations$youHave:(0,i18n.Iu)("youHaveLoggedInAs").replace("%userName%",null!==(_newUser$name=newUser.name)&&void 0!==_newUser$name?_newUser$name:"").replace("{{userName}}",null!==(_newUser$name2=newUser.name)&&void 0!==_newUser$name2?_newUser$name2:""),loginCaption:null!==(_translations$login=translations?.login)&&void 0!==_translations$login?_translations$login:(0,i18n.Iu)("login"),loginToCaption:null!==(_translations$loginTo=translations?.loginTo)&&void 0!==_translations$loginTo?_translations$loginTo:(0,i18n.Iu)("loginTo"),confirmLabel:null!==(_translations$applyCh=translations?.applyChange)&&void 0!==_translations$applyCh?_translations$applyCh:(0,i18n.Iu)("applyChange"),tryAgainLabel:null!==(_translations$tryAgai=translations?.tryAgainLabel)&&void 0!==_translations$tryAgai?_translations$tryAgai:(0,i18n.Iu)("tryAgainLabel"),cancelLabel:null!==(_translations$postpon=translations?.postpone)&&void 0!==_translations$postpon?_translations$postpon:(0,i18n.Iu)("postpone"),onConfirm:()=>{done(),onApply()},onCancel:()=>{done(),onPostpone()}})}_extractErrorMessage(error){if(!error)return null;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&console.error("RingUI Auth error",error);try{if("code"in error&&error.code&&"object"==typeof error.code&&"code"in error.code&&"string"==typeof error.code.code){return`Authorization error: ${error.code.code.split("_").join(" ")}`}}catch{}return error.toString?error.toString():null}_showBackendDownDialog(backendError){const{onBackendDown:onBackendDown,translations:translations}=this.config;let timerId;return new Promise(((resolve,reject)=>{const done=()=>{hide(),window.removeEventListener("online",onCheckAgain),stopListeningCloseMessage?.(),this._storage?.sendMessage(Auth.CLOSE_BACKEND_DOWN_MESSAGE,Date.now()),clearTimeout(timerId)},stopListeningCloseMessage=this._storage?.onMessage(Auth.CLOSE_BACKEND_DOWN_MESSAGE,(()=>{stopListeningCloseMessage?.(),done(),resolve()})),onCheckAgain=async()=>{await this._checkBackendsAreUp(),done(),resolve()},hide=onBackendDown({onCheckAgain:onCheckAgain,onPostpone:()=>{done(),reject(new Error("Auth(@jetbrains/ring-ui): postponed by user"))},backendError:backendError,translations:null!=translations?translations:(0,i18n.l2)()});window.addEventListener("online",onCheckAgain),timerId=window.setTimeout((function networkWatchdog(){navigator&&navigator.onLine&&onCheckAgain(),timerId=window.setTimeout(networkWatchdog,5e3)}),5e3)}))}async logout(extraParams){const requestParams={request_credentials:"required",...extraParams};await this._checkBackendsStatusesIfEnabled(),await this.listeners.trigger("logout"),this._updateDomainUser(null),await(this._storage?.wipeToken());const authRequest=await(this._requestBuilder?.prepareAuthRequest(requestParams));null!=authRequest&&this._redirectCurrentPage(authRequest.url)}async _runEmbeddedLogin(){this._storage?.sendMessage(Auth.CLOSE_WINDOW_MESSAGE,Date.now());try{return this._isLoginWindowOpen=!0,await(this._embeddedFlow?.authorize())}catch(e){throw e}finally{this._isLoginWindowOpen=!1}}async login(){if(this.config.embeddedLogin)await this._runEmbeddedLogin();else{await this._checkBackendsStatusesIfEnabled();try{const accessToken=await(this._backgroundFlow?.authorize()),user=await this.getUser(accessToken);user.guest?this._beforeLogout():(this.user=user,this.listeners.trigger(USER_CHANGED_EVENT,user))}catch(e){this._beforeLogout()}}}async switchUser(){if(!this.config.embeddedLogin)throw new Error('Auth: switchUser only supported for "embeddedLogin" mode');await this._runEmbeddedLogin()}async _checkForAuthResponse(){const authResponse=this._responseParser.getAuthResponseFromURL(),{scope:defaultScope,defaultExpiresIn:defaultExpiresIn,cleanHash:cleanHash}=this.config;if(authResponse&&cleanHash&&this.setHash(""),!authResponse)return;const{state:stateId,scope:scope,expiresIn:expiresIn,accessToken:accessToken}=authResponse,newState=await(stateId&&this._storage?.getState(stateId))||{},scopes=scope?scope.split(" "):newState.scopes||defaultScope||[],effectiveExpiresIn=expiresIn?parseInt(expiresIn,10):defaultExpiresIn,expires=TokenValidator._epoch()+effectiveExpiresIn;return null!=accessToken&&await(this._storage?.saveToken({accessToken:accessToken,scopes:scopes,expires:expires,lifeTime:effectiveExpiresIn})),newState}async _checkForStateRestoration(){const authResponse=this._responseParser._authResponse;authResponse&&this.config.cleanHash&&this.setHash("");const stateId=authResponse?.restoreAuthState;return await(stateId&&this._storage?.getState(stateId))||{}}_checkBackendsAreUp(){const abortCtrl=new AbortController,{backendCheckTimeout:backendCheckTimeout}=this.config;return Promise.all([promiseWithTimeout(this.http.fetch("settings/public?fields=id",{signal:abortCtrl.signal}),backendCheckTimeout,{error:new Error("The authorization server is taking too long to respond. Please try again later."),onTimeout:()=>abortCtrl.abort()}),this.config.checkBackendIsUp()]).catch((err=>{if(err instanceof TypeError)throw new TypeError("Could not connect to the server due to network error. Please check your connection and try again.");throw err}))}async _checkBackendsStatusesIfEnabled(){if(this.config.enableBackendStatusCheck)try{await this._checkBackendsAreUp()}catch(backendDownErr){backendDownErr instanceof Error&&await this._showBackendDownDialog(backendDownErr)}}setUpPreconnect(url){const linkNode=document.createElement("link");linkNode.rel="preconnect",linkNode.href=url,linkNode.pr="1.0",linkNode.crossOrigin="use-credentials",document.head.appendChild(linkNode)}_redirectCurrentPage(url){window.location.href=(0,global_url.$h)(url)}_reloadCurrentPage(){this._redirectCurrentPage(window.location.href)}_canShowDialogs(){return this.config.embeddedLogin&&this._authDialogService}setHash(hash){if(history.replaceState){const cleanedUrl=[window.location.pathname,window.location.search].join(""),hashIfExist=hash?`#${hash}`:"";history.replaceState(void 0,"",`${cleanedUrl}${hashIfExist}`)}else window.location.hash=hash}}},"./src/auth/background-flow.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{W:function(){return HUB_AUTH_PAGE_OPENED},Z:function(){return BackgroundFlow}});var _response_parser__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/auth/response-parser.ts");const HUB_AUTH_PAGE_OPENED="HUB_AUTH_PAGE_OPENED";class BackgroundFlow{_requestBuilder;_storage;_timeout;_promise;constructor(requestBuilder,storage,timeout){this._requestBuilder=requestBuilder,this._storage=storage,this._timeout=timeout}_createHiddenFrame(){const iframe=document.createElement("iframe");return iframe.style.border=iframe.style.width=iframe.style.height="0px",iframe.style.visibility="hidden",iframe.style.position="fixed",iframe.style.left="-10000px",window.document.body.appendChild(iframe),iframe}_redirectFrame(iframe,url){iframe.src=`${url}&rnd=${Math.random()}`}async _load(){const authRequest=await this._requestBuilder.prepareAuthRequest({request_credentials:"silent"},{nonRedirect:!0});return new Promise(((resolve,reject)=>{function onMessage(e){e.data===HUB_AUTH_PAGE_OPENED&&(reject(new Error("Failed to obtain/refresh token in background")),cleanUp())}window.addEventListener("message",onMessage);const iframe=this._createHiddenFrame();let cleanRun;const timeout=setTimeout((()=>{reject(new Error("Failed to refresh authorization")),cleanUp()}),this._timeout),removeTokenListener=this._storage.onTokenChange((token=>{token&&(cleanUp(),resolve(token.accessToken))})),removeStateListener=this._storage.onStateChange(authRequest.stateId,(state=>{state&&state.error&&(cleanUp(),reject(new _response_parser__WEBPACK_IMPORTED_MODULE_0__.Z.AuthError(state)))}));function cleanUp(){cleanRun||(cleanRun=!0,clearTimeout(timeout),removeStateListener(),removeTokenListener(),window.removeEventListener("message",onMessage),window.document.body.removeChild(iframe))}this._redirectFrame(iframe,authRequest.url)}))}authorize(){if(this._promise)return this._promise;const resetPromise=()=>{this._promise=null};return this._promise=this._load(),this._promise.then(resetPromise,resetPromise),this._promise}}},"./src/auth/response-parser.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return AuthResponseParser}});var es6_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/es6-error/es6/index.js"),_global_url__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/global/url.ts");class AuthError extends es6_error__WEBPACK_IMPORTED_MODULE_0__.Z{code;uri;stateId;constructor(){let authResponse=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(authResponse.errorDescription),this.code=authResponse.error,this.uri=authResponse.errorUri,this.stateId=authResponse.state}}class AuthResponseParser{_authResponse;constructor(){this._authResponse=this.readAuthResponseFromURL()}static AuthError=AuthError;static convertKey(key){return key.replace(/_([a-z])/g,((_,letter)=>letter.toUpperCase()))}getAuthResponseFromURL(){return this.validateAuthResponse(this._authResponse)}validateAuthResponse(authResponse){if(authResponse.error)throw new AuthResponseParser.AuthError(authResponse);return authResponse.accessToken?{...authResponse,accessToken:authResponse.accessToken}:null}readAuthResponseFromURL(){const authResponse={},rawAuthResponse=(0,_global_url__WEBPACK_IMPORTED_MODULE_1__.dD)(this.getHash());return Object.keys(rawAuthResponse).forEach((key=>{-1===key.indexOf("_")?authResponse[key]=rawAuthResponse[key]:authResponse[AuthResponseParser.convertKey(key)]=rawAuthResponse[key]})),authResponse}getHash(){const location=this.getLocation();return location&&location.replace(/^[^#]*#?/,"")}getLocation(){return window.location.toString()}}},"./src/group/group.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return Group}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_3__),classnames__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/classnames/index.js"),classnames__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_1__),_group_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/group/group.css"),_group_css__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_group_css__WEBPACK_IMPORTED_MODULE_2__);function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}class Group extends react__WEBPACK_IMPORTED_MODULE_0__.Component{static propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_3___default().node,className:prop_types__WEBPACK_IMPORTED_MODULE_3___default().string};render(){const{children:children,className:className,...restProps}=this.props,classes=classnames__WEBPACK_IMPORTED_MODULE_1___default()(_group_css__WEBPACK_IMPORTED_MODULE_2___default().group,className);return react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",_extends({},restProps,{className:classes}),children)}}Group.__docgenInfo={description:"@name Group",methods:[],displayName:"Group",props:{children:{type:{name:"node"},required:!1,description:""},className:{type:{name:"string"},required:!1,description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/group/group.tsx"]={name:"Group",docgenInfo:Group.__docgenInfo,path:"src/group/group.tsx"})},"./src/http/http.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{ZP:function(){return HTTP},cO:function(){return CODE}});var es6_error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/es6-error/es6/index.js"),_global_url__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/global/url.ts");const defaultFetchConfig={headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"same-origin"};class HTTPError extends es6_error__WEBPACK_IMPORTED_MODULE_0__.Z{data;status;constructor(response){let data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(`${response.status} ${response.statusText||""}`),this.data=data,this.status=response.status}}const CODE={UNAUTHORIZED:401};class HTTP{baseUrl=null;_requestsMeta=new WeakMap;fetchConfig;requestToken;shouldRefreshToken;forceTokenUpdate;constructor(auth,baseUrl){let fetchConfig=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};auth&&this.setAuth(auth),this.setBaseUrl(baseUrl);const{headers:headers,...defaultConfig}=defaultFetchConfig;this.fetchConfig={...defaultConfig,...fetchConfig,headers:{...headers,...fetchConfig.headers}}}setAuth=auth=>{this.requestToken=()=>auth.requestToken(),this.shouldRefreshToken=auth.constructor.shouldRefreshToken,this.forceTokenUpdate=()=>auth.forceTokenUpdate()};setBaseUrl=baseUrl=>{this.baseUrl=baseUrl};_fetch(){return fetch(...arguments)}_makeRequestUrl(url,queryObject){const urlWithQuery=(0,_global_url__WEBPACK_IMPORTED_MODULE_1__.EQ)(url,queryObject);return(0,_global_url__WEBPACK_IMPORTED_MODULE_1__.ZK)(this.baseUrl,urlWithQuery)}_performRequest(url,token){let params=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{headers:headers,body:body,query:query={},sendRawBody:sendRawBody,...fetchConfig}=params,combinedHeaders={...this.fetchConfig.headers,...token?{Authorization:`Bearer ${token}`}:{},...headers};let bodyToSend;return Object.entries(combinedHeaders).forEach((_ref=>{let[key,header]=_ref;null==header&&Reflect.deleteProperty(combinedHeaders,key)})),bodyToSend=function isRawBody(params){return!0===params.sendRawBody}(params)||null===params.body||void 0===params.body||""===params.body?params.body:JSON.stringify(body),this._fetch(this._makeRequestUrl(url,query),{...this.fetchConfig,headers:combinedHeaders,...fetchConfig,body:bodyToSend})}_storeRequestMeta(parsedResponse,rawResponse){const{headers:headers,ok:ok,redirected:redirected,status:status,statusText:statusText,type:type,url:url}=rawResponse;this._requestsMeta.set(parsedResponse,{headers:headers,ok:ok,redirected:redirected,status:status,statusText:statusText,type:type,url:url})}async _processResponse(response){const contentType=response.headers?.get("content-type"),isJson=contentType&&-1!==contentType.indexOf("application/json");if(null!=response.status&&HTTP._isErrorStatus(response.status)){let resJson;try{resJson=await(isJson?response.json?.():response.text?.())}catch(err){}throw new HTTPError(response,resJson)}try{const parsedResponse=await(isJson?response.json?.():{data:await(response.text?.())});return this._storeRequestMeta(parsedResponse,response),parsedResponse}catch(err){return response}}static _isErrorStatus(status){return status<200||status>=300}fetch=(()=>{var _this=this;return async function(url){let params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{body:body,query:query={},...fetchConfig}=params,response=await _this._fetch(_this._makeRequestUrl(url,query),{...fetchConfig,headers:fetchConfig.headers,body:null!=body&&""!==body?JSON.stringify(body):body});return _this._processResponse(response)}})();async authorizedFetch(){const response=await this._performRequest(...arguments);return this._processResponse(response)}request=async(url,params)=>{let token=await(this.requestToken?.()),response=await this._performRequest(url,token,params);try{return await this._processResponse(response)}catch(error){if(!(error instanceof HTTPError))throw error;if(void 0!==error.data.error&&this.shouldRefreshToken?.(error.data.error))return token=await(this.forceTokenUpdate?.()),response=await this._performRequest(url,token,params),this._processResponse(response);throw error}};getMetaForResponse=response=>this._requestsMeta.get(response);get=(url,params)=>this.request(url,{...params,method:"GET"});post=(url,params)=>this.request(url,{...params,method:"POST"});delete=(url,params)=>this.request(url,{...params,method:"DELETE"});put=(url,params)=>this.request(url,{...params,method:"PUT"});abortify=method=>{var _this2=this;return function(){for(var _len=arguments.length,_ref2=new Array(_len),_key=0;_key<_len;_key++)_ref2[_key]=arguments[_key];let[url,params]=_ref2;const ctrl=new AbortController;return params&&!("signal"in params)&&(params.signal=ctrl.signal),{promise:method.call(_this2,url,params),abort:()=>ctrl.abort()}}}}},"./src/storage/storage.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return storage}});var alert_service=__webpack_require__("./src/alert-service/alert-service.tsx");class LocalStorage{static async safePromise(resolver){try{return await new Promise(resolver)}catch(e){throw e instanceof Error&&"NS_ERROR_FILE_CORRUPTED"===e.name&&alert_service.Z.error('Sorry, it looks like your browser storage is corrupted. Please clear your storage by going to Tools -> Clear Recent History -> Cookies and setting time range to "Everything". This will remove the corrupted browser storage across all sites.'),e}}storageType;constructor(){let config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.storageType="session"===config.type?"sessionStorage":"localStorage"}get(name){return LocalStorage.safePromise((resolve=>{const value=window[this.storageType].getItem(name);if(null!=value)try{resolve(JSON.parse(value))}catch(e){resolve(value)}else resolve(value)}))}set(name,value){return LocalStorage.safePromise((resolve=>{window[this.storageType].setItem(name,JSON.stringify(value)),resolve(value)}))}remove(name){const storageType=this.storageType;return LocalStorage.safePromise((resolve=>{window[storageType].hasOwnProperty(name)&&window[storageType].removeItem(name),resolve()}))}each(callback){const storageType=this.storageType;return LocalStorage.safePromise((resolve=>{const promises=[];for(const item in window[storageType])if(window[storageType].hasOwnProperty(item)){const value=window[storageType].getItem(item);let resolvedValue=null;if(null!=value)try{resolvedValue=JSON.parse(value)}catch(e){resolvedValue=value}promises.push(Promise.resolve(callback(item,resolvedValue)))}resolve(Promise.all(promises))}))}on(name,callback){function handleStorage(e){if(e.key===name)if(null!=e.newValue)try{callback(JSON.parse(e.newValue))}catch(err){callback(e.newValue)}else callback(e.newValue)}return window.addEventListener("storage",handleStorage,!1),()=>window.removeEventListener("storage",handleStorage,!1)}}var deep_equal=__webpack_require__("./node_modules/deep-equal/index.js"),deep_equal_default=__webpack_require__.n(deep_equal);class FallbackStorage{static DEFAULT_COOKIE_NAME="localStorage";static DEFAULT_SESSION_COOKIE_NAME="sessionStorage";static DEFAULT_CHECK_DELAY=3e3;static COOKIE_EXPIRES=365;static QUOTA=4093;static _createCookie(name,value,days){let date,expires;days?(date=new Date,date.setTime(date.getTime()+864e5*days),expires=`; expires=${date.toUTCString()}`):expires=";",document.cookie=`${name}=${value}${expires}; path=/`}static _readCookie(name){const nameEQ=`${name}=`,cookies=document.cookie.split(";");let cookie;for(let i=0;i<cookies.length;i++){for(cookie=cookies[i];" "===cookie.charAt(0);)cookie=cookie.substring(1,cookie.length);if(0===cookie.indexOf(nameEQ))return cookie.substring(nameEQ.length,cookie.length)}}cookieName;checkDelay;expires;constructor(){let config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const session="session"===config.type;this.cookieName=config.cookieName||(session?FallbackStorage.DEFAULT_SESSION_COOKIE_NAME:FallbackStorage.DEFAULT_COOKIE_NAME),this.checkDelay=config.checkDelay||FallbackStorage.DEFAULT_CHECK_DELAY,this.expires=session?FallbackStorage.COOKIE_EXPIRES:null}_read(){return new Promise(((resolve,reject)=>{const rawData=FallbackStorage._readCookie(this.cookieName);null!=rawData?resolve(JSON.parse(decodeURIComponent(rawData))):reject()})).catch((()=>({})))}_write(data){return new Promise((resolve=>{const stringData=encodeURIComponent(JSON.stringify(data));return FallbackStorage._createCookie(this.cookieName,"{}"===stringData?"":stringData,this.expires),resolve(data)}))}get(key){return this._read().then((data=>data[key]||null))}async set(key,value){const data=await this._read();return key&&(null!=value?data[key]=value:Reflect.deleteProperty(data,key)),await this._write(data),value}async remove(key){await this.set(key,null)}each(callback){return"function"!=typeof callback?Promise.reject(new Error("Callback is not a function")):this._read().then((data=>{const promises=[];for(const key in data)data.hasOwnProperty(key)&&promises.push(callback(key,data[key]));return Promise.all(promises)}))}on(key,callback){let stop=!1;const checkForChange=oldValue=>{this.get(key).then((newValue=>{stop||(deep_equal_default()(oldValue,newValue)||callback(newValue),window.setTimeout((()=>checkForChange(oldValue)),this.checkDelay))}))};return this.get(key).then(checkForChange),()=>{stop=!0}}}let Storage=LocalStorage;try{const temp="testStorage";localStorage.setItem(temp,temp),localStorage.removeItem(temp)}catch(e){Storage=FallbackStorage}var storage=Storage},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!./src/auth/down-notification.css":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__),_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_global_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!./src/global/global.css"),_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_variables_css__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!./src/global/variables.css"),___CSS_LOADER_EXPORT___=_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.i(_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_variables_css__WEBPACK_IMPORTED_MODULE_3__.default),___CSS_LOADER_EXPORT___.i(_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_global_css__WEBPACK_IMPORTED_MODULE_2__.default,"",!0),___CSS_LOADER_EXPORT___.push([module.id,".title_d876 {\n  font-weight: 600;\n}\n\n.error_e0ca {\n  margin-top: 4px;\n\n  word-wrap: break-word;\n\n  color: var(--ring-text-color);\n\n  line-height: 16px;\n}\n","",{version:3,sources:["webpack://./src/auth/down-notification.css"],names:[],mappings:"AAIA;EACE,gBAAgB;AAClB;;AAEA;EACE,eAA0B;;EAE1B,qBAAqB;;EAErB,6BAA6B;;EAE7B,iBAA2B;AAC7B",sourcesContent:['@import "../global/variables.css";\n\n@value unit from "../global/global.css";\n\n.title {\n  font-weight: 600;\n}\n\n.error {\n  margin-top: calc(unit / 2);\n\n  word-wrap: break-word;\n\n  color: var(--ring-text-color);\n\n  line-height: calc(unit * 2);\n}\n'],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={unit:""+_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_global_css__WEBPACK_IMPORTED_MODULE_2__.default.locals.unit,title:"title_d876",error:"error_e0ca"},__webpack_exports__.default=___CSS_LOADER_EXPORT___},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!./src/group/group.css":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__),_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_global_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!./src/global/global.css"),_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_variables_css__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!./src/global/variables.css"),___CSS_LOADER_EXPORT___=_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.i(_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_variables_css__WEBPACK_IMPORTED_MODULE_3__.default),___CSS_LOADER_EXPORT___.i(_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_global_css__WEBPACK_IMPORTED_MODULE_2__.default,"",!0),___CSS_LOADER_EXPORT___.push([module.id,".group_ba3b > *:not(:last-child) {\n    margin-right: 8px;\n  }\n","",{version:3,sources:["webpack://./src/group/group.css"],names:[],mappings:"AAKE;IACE,iBAAkB;EACpB",sourcesContent:['@import "../global/variables.css";\n\n@value unit from "../global/global.css";\n\n.group {\n  & > *:not(:last-child) {\n    margin-right: unit;\n  }\n}\n'],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={unit:""+_node_modules_css_loader_dist_cjs_js_ruleSet_1_rules_1_use_1_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_1_use_2_global_global_css__WEBPACK_IMPORTED_MODULE_2__.default.locals.unit,group:"group_ba3b"},__webpack_exports__.default=___CSS_LOADER_EXPORT___},"./node_modules/es6-error/es6/index.js":function(__unused_webpack_module,__webpack_exports__){"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}var ExtendableError=function(_extendableBuiltin2){function ExtendableError(){var message=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ExtendableError);var _this=_possibleConstructorReturn(this,(ExtendableError.__proto__||Object.getPrototypeOf(ExtendableError)).call(this,message));return Object.defineProperty(_this,"message",{configurable:!0,enumerable:!1,value:message,writable:!0}),Object.defineProperty(_this,"name",{configurable:!0,enumerable:!1,value:_this.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?(Error.captureStackTrace(_this,_this.constructor),_possibleConstructorReturn(_this)):(Object.defineProperty(_this,"stack",{configurable:!0,enumerable:!1,value:new Error(message).stack,writable:!0}),_this)}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ExtendableError,_extendableBuiltin2),ExtendableError}(function _extendableBuiltin(cls){function ExtendableBuiltin(){cls.apply(this,arguments)}return ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(ExtendableBuiltin,cls):ExtendableBuiltin.__proto__=cls,ExtendableBuiltin}(Error));__webpack_exports__.Z=ExtendableError},"./node_modules/simply-uuid/index.js":function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__("./node_modules/simply-uuid/lib/uuid-node.js")},"./node_modules/simply-uuid/lib/uuid-node.js":function(module,exports){"use strict";module.exports.generate=function(){for(var lut=[],i=0;i<256;i++)lut[i]=(i<16?"0":"")+i.toString(16);var d0=4294967295*Math.random()|0,d1=4294967295*Math.random()|0,d2=4294967295*Math.random()|0,d3=4294967295*Math.random()|0;return lut[255&d0]+lut[d0>>8&255]+lut[d0>>16&255]+lut[d0>>24&255]+"-"+lut[255&d1]+lut[d1>>8&255]+"-"+lut[d1>>16&15|64]+lut[d1>>24&255]+"-"+lut[63&d2|128]+lut[d2>>8&255]+"-"+lut[d2>>16&255]+lut[d2>>24&255]+lut[255&d3]+lut[d3>>8&255]+lut[d3>>16&255]+lut[d3>>24&255]}},"./src/auth/down-notification.css":function(module,__unused_webpack_exports,__webpack_require__){var API=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),domAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),insertFn=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),setAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),styleTagTransformFn=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),content=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!./src/auth/down-notification.css");content=content.__esModule?content.default:content;var options={};options.styleTagTransform=styleTagTransformFn,options.setAttributes=setAttributes,options.insert=insertFn.bind(null,"head"),options.domAPI=domAPI,options.insertStyleElement=insertStyleElement;API(content,options);module.exports=content&&content.locals||{}},"./src/group/group.css":function(module,__unused_webpack_exports,__webpack_require__){var API=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),domAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),insertFn=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),setAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),styleTagTransformFn=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),content=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!./src/group/group.css");content=content.__esModule?content.default:content;var options={};options.styleTagTransform=styleTagTransformFn,options.setAttributes=setAttributes,options.insert=insertFn.bind(null,"head"),options.domAPI=domAPI,options.insertStyleElement=insertStyleElement;API(content,options);module.exports=content&&content.locals||{}}}]);